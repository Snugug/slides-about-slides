{"version":3,"file":"upgrade.js","sources":["../../node_modules/stage-fright/src/js/lib/buttons.js","../../node_modules/stage-fright/src/js/lib/minimap.js","../../node_modules/stage-fright/src/js/lib/navigation/keys.js","../../node_modules/stage-fright/src/js/lib/autoplay.js","../../node_modules/stage-fright/src/js/lib/upgrade.js"],"sourcesContent":["import { loadImage, loadMedia } from './lazyload';\n\nexport default function(store) {\n  const holder = document.createElement('div');\n  holder.classList.add('btns');\n\n  holder.appendChild(downloadImages());\n  holder.appendChild(toggleDisplay(store));\n  holder.appendChild(hiddenPresButton());\n\n  return holder;\n}\n\nfunction buildButton(title, image) {\n  const btn = document.createElement('button');\n  btn.classList.add(`btns--btn`);\n  btn.setAttribute('aria-label', title);\n  btn.innerHTML = image;\n  return btn;\n}\n\nfunction hiddenPresButton() {\n  const btn = document.createElement('button');\n  btn.classList.add('btns--hidden');\n  btn.setAttribute('aria-label', 'Presentation Navigation Keyboard Focus');\n  btn.innerHTML = '';\n  return btn;\n}\n\nfunction downloadImages() {\n  const icon = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\"><path d=\"M24.708 13.207l-1.414-1.415L17 18.087V1.5h-2v16.585l-6.292-6.293-1.414 1.415 8.707 8.707z\"/><path d=\"M29 18.5v8H3v-8H1v12h30v-12z\"/></svg>';\n  const btn = buildButton('Download All Assets', icon);\n\n  btn.addEventListener('click', () => {\n    // Swap in\n    const images = document.querySelectorAll('picture, img');\n    const media = document.querySelectorAll('video, audio');\n    images.forEach(image => loadImage(image));\n    media.forEach(item => loadMedia(item));\n    btn.parentNode.removeChild(btn);\n  });\n\n  return btn;\n}\n\nfunction toggleDisplay(store) {\n  const presentation = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\"><path d=\"M19 3h10v10H19z\"/><path d=\"M17 3H3v26h26V15H17V3zm-2 24H5V17h10v10zm12-10v10H17V17h10zM5 15V5h10v10H5z\"/></svg>';\n  const article = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\"><path d=\"M3 6h22v2H3zM3 12h14v2H3zM3 18h26v2H3zM3 24h14v2H3z\"/></svg>';\n  const btn = buildButton('Toggle Article/Presentation Display', article);\n\n  btn.addEventListener('click', () => {\n    store.dispatch('display', 'toggle');\n  });\n\n  store.changes.subscribe('display', (state) => {\n    if (state.display === 'presentation') {\n      btn.innerHTML = article;\n    } else {\n      btn.innerHTML = presentation;\n    }\n  });\n\n  return btn;\n}\n","export function buildMinimap(stage) {\n  const minimap = document.createElement('nav');\n  minimap.classList.add('minimap');\n\n  stage.forEach(item => {\n    if (item.first) {\n      const section = document.createElement('div');\n      section.classList.add('minimap--section');\n      minimap.appendChild(section);\n    }\n\n    minimap.lastChild.appendChild(item.progress);\n  });\n\n  return minimap;\n}\n\nexport function createMinimapLink(to, section, depth, fragment = false) {\n  const link = document.createElement('a');\n  link.classList.add('minimap--slide');\n  link.href = `#/${to}`;\n  link.innerText = `Section ${section}, Slide ${depth}`;\n  link.dataset.fragments = fragment;\n\n  return link;\n}\n","export default function(store, opts = {}) {\n  document.addEventListener('keydown', (e) => {\n    if (store.state.display === 'presentation' && !e.target.classList.contains('btns--btn')) {\n      const whereto = spaceMove(e, opts);\n      if (whereto) {\n        if (whereto !== 'notes') {\n          store.dispatch('navigate', whereto);    \n        } else {\n          store.dispatch('notes', 'toggle');\n        }\n      }  \n    }\n  });\n}\n\nfunction spaceMove(e, opts) {\n  const modifiers = {         \n    ctrl: e.ctrlKey === true,   // ⌃\n    alt: e.altKey === true,     // ⌥\n    meta: e.metaKey === true,   // ⌘\n    shift: e.shiftKey === true, // ⇧\n  }\n\n  let previous = false;\n  let next = false;\n\n  // Set up Spacebar nav, with or without modifiers\n  if (opts.spacebar !== false) {\n    let spacebar = e.keyCode === 32;\n    let shiftSpacebar = spacebar && modifiers['shift'];\n\n    if (opts.spacebar !== true) {\n      spacebar = spacebar && modifiers[opts.spacebar];\n      shiftSpacebar = shiftSpacebar && modifiers[opts.spacebar];\n    }\n\n    previous = shiftSpacebar;\n    next = spacebar; \n  }\n\n  // Set up Remote nav, with or without modifiers\n  if (opts.remote !== false) {\n    let pageUp = e.keyCode === 33;\n    let pageDown = e.keyCode === 34;\n\n    if (opts.remote !== true) {\n      pageUp = pageUp && modifiers[opts.remote];\n      pageDown = pageDown && modifiers[opts.remote];\n    }\n\n    previous = previous || pageUp;\n    next = next || pageDown;\n  }\n\n  // Do previous or next navigation\n  if (previous) {\n    return 'previous';\n  }\n\n  if (next) {\n    return 'next';\n  }\n  \n\n  // S + CMD + Shift key\n  if (e.keyCode === 83 && modifiers['alt'] && modifiers['shift']) {\n    return 'notes';\n  }\n\n  return false;\n}\n","import { loadMedia } from './lazyload';\n\nexport function playVideo(entry) {\n  const elem = entry.target;\n  elem.pause();\n  elem.currentTime = 0;\n\n  if (entry.isIntersecting) {\n    if (!elem.src) {\n      loadMedia(elem);\n    }\n    \n    window.setTimeout(() => {\n      elem.play();\n    }, 200);  \n  }\n}\n\nexport function playVideoObserver(entries) {\n  entries.forEach((entry) => {\n    playVideo(entry);\n  });\n}\n\nexport default function () {\n  const videos = document.querySelectorAll('video[data-autoplay]');\n\n  if ('IntersectionObserver' in window) {\n    const observer = new IntersectionObserver(playVideoObserver);\n    videos.forEach(video => observer.observe(video));\n  }\n}\n","import buttons from './buttons';\nimport { buildMinimap, createMinimapLink } from './minimap';\nimport keys from './navigation/keys';\nimport autoplay from './autoplay';\nimport { receivePresentationControls } from './presentation';\n\nexport function upgrade(stage, rootNode, start, options) {\n  // Add Buttons\n  stage._head.elem.querySelector('._stage--content').insertAdjacentElement('beforebegin', buttons(this.store)); \n\n  stage.buildProgress(this.store, createMinimapLink);\n  rootNode.parentNode.appendChild(buildMinimap(stage));\n  this.goto(start);\n\n  // Set up keyboard navigation\n  keys(this.store, options);\n\n  // Set up Autoplay\n  autoplay();\n\n  // Make sure Presentation Controls work\n  receivePresentationControls(this.store);  \n}\n"],"names":["store","holder","document","createElement","classList","add","appendChild","downloadImages","toggleDisplay","hiddenPresButton","buildButton","title","image","btn","setAttribute","innerHTML","addEventListener","images","querySelectorAll","media","forEach","loadImage","item","loadMedia","parentNode","removeChild","article","dispatch","changes","subscribe","state","display","buildMinimap","stage","minimap","first","section","lastChild","progress","createMinimapLink","to","depth","fragment","link","href","innerText","dataset","fragments","opts","e","target","contains","whereto","spaceMove","modifiers","ctrl","ctrlKey","alt","altKey","meta","metaKey","shift","shiftKey","previous","next","spacebar","keyCode","shiftSpacebar","remote","pageUp","pageDown","playVideo","entry","elem","pause","currentTime","isIntersecting","src","window","setTimeout","play","playVideoObserver","entries","videos","observer","IntersectionObserver","video","observe","upgrade","rootNode","start","options","_head","querySelector","insertAdjacentElement","buttons","buildProgress","goto","keys","autoplay","receivePresentationControls"],"mappings":"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"}